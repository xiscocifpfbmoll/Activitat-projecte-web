!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["ue-swg"]=t():e.ueSwg=t()}(window,(function(){return function(e){var t={};function n(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(s,o,function(t){return e[t]}.bind(null,o));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";n.r(t),n.d(t,"ueSwg",(function(){return gt}));var s={UNKNOWN:0,IMPRESSION_PAYWALL:1,IMPRESSION_AD:2,IMPRESSION_OFFERS:3,IMPRESSION_SUBSCRIBE_BUTTON:4,IMPRESSION_SMARTBOX:5,IMPRESSION_SWG_BUTTON:6,IMPRESSION_CLICK_TO_SHOW_OFFERS:7,IMPRESSION_CLICK_TO_SHOW_OFFERS_OR_ALREADY_SUBSCRIBED:8,IMPRESSION_SUBSCRIPTION_COMPLETE:9,IMPRESSION_ACCOUNT_CHANGED:10,IMPRESSION_PAGE_LOAD:11,IMPRESSION_LINK:12,IMPRESSION_SAVE_SUBSCR_TO_GOOGLE:13,IMPRESSION_GOOGLE_UPDATED:14,IMPRESSION_SHOW_OFFERS_SMARTBOX:15,IMPRESSION_SHOW_OFFERS_SWG_BUTTON:16,IMPRESSION_SELECT_OFFER_SMARTBOX:17,IMPRESSION_SELECT_OFFER_SWG_BUTTON:18,IMPRESSION_SHOW_CONTRIBUTIONS_SWG_BUTTON:19,IMPRESSION_SELECT_CONTRIBUTION_SWG_BUTTON:20,IMPRESSION_METER_TOAST:21,IMPRESSION_REGWALL:22,IMPRESSION_SHOWCASE_REGWALL:23,IMPRESSION_SWG_SUBSCRIPTION_MINI_PROMPT:24,IMPRESSION_SWG_CONTRIBUTION_MINI_PROMPT:25,IMPRESSION_CONTRIBUTION_OFFERS:26,ACTION_SUBSCRIBE:1e3,ACTION_PAYMENT_COMPLETE:1001,ACTION_ACCOUNT_CREATED:1002,ACTION_ACCOUNT_ACKNOWLEDGED:1003,ACTION_SUBSCRIPTIONS_LANDING_PAGE:1004,ACTION_PAYMENT_FLOW_STARTED:1005,ACTION_OFFER_SELECTED:1006,ACTION_SWG_BUTTON_CLICK:1007,ACTION_VIEW_OFFERS:1008,ACTION_ALREADY_SUBSCRIBED:1009,ACTION_NEW_DEFERRED_ACCOUNT:1010,ACTION_LINK_CONTINUE:1011,ACTION_LINK_CANCEL:1012,ACTION_GOOGLE_UPDATED_CLOSE:1013,ACTION_USER_CANCELED_PAYFLOW:1014,ACTION_SAVE_SUBSCR_TO_GOOGLE_CONTINUE:1015,ACTION_SAVE_SUBSCR_TO_GOOGLE_CANCEL:1016,ACTION_SWG_BUTTON_SHOW_OFFERS_CLICK:1017,ACTION_SWG_BUTTON_SELECT_OFFER_CLICK:1018,ACTION_SWG_BUTTON_SHOW_CONTRIBUTIONS_CLICK:1019,ACTION_SWG_BUTTON_SELECT_CONTRIBUTION_CLICK:1020,ACTION_USER_CONSENT_DEFERRED_ACCOUNT:1021,ACTION_USER_DENY_DEFERRED_ACCOUNT:1022,ACTION_DEFERRED_ACCOUNT_REDIRECT:1023,ACTION_GET_ENTITLEMENTS:1024,ACTION_METER_TOAST_SUBSCRIBE_CLICK:1025,ACTION_METER_TOAST_EXPANDED:1026,ACTION_METER_TOAST_CLOSED_BY_ARTICLE_INTERACTION:1027,ACTION_METER_TOAST_CLOSED_BY_SWIPE_DOWN:1028,ACTION_METER_TOAST_CLOSED_BY_X_CLICKED:1029,ACTION_SWG_SUBSCRIPTION_MINI_PROMPT_CLICK:1030,ACTION_SWG_CONTRIBUTION_MINI_PROMPT_CLICK:1031,ACTION_SWG_SUBSCRIPTION_MINI_PROMPT_CLOSE:1032,ACTION_SWG_CONTRIBUTION_MINI_PROMPT_CLOSE:1033,ACTION_CONTRIBUTION_OFFER_SELECTED:1034,ACTION_SHOWCASE_REGWALL_GSI_CLICK:1035,ACTION_SHOWCASE_REGWALL_EXISTING_ACCOUNT_CLICK:1036,EVENT_PAYMENT_FAILED:2e3,EVENT_CUSTOM:3e3,EVENT_CONFIRM_TX_ID:3001,EVENT_CHANGED_TX_ID:3002,EVENT_GPAY_NO_TX_ID:3003,EVENT_GPAY_CANNOT_CONFIRM_TX_ID:3004,EVENT_GOOGLE_UPDATED:3005,EVENT_NEW_TX_ID:3006,EVENT_UNLOCKED_BY_SUBSCRIPTION:3007,EVENT_UNLOCKED_BY_METER:3008,EVENT_NO_ENTITLEMENTS:3009,EVENT_HAS_METERING_ENTITLEMENTS:3010,EVENT_OFFERED_METER:3011,EVENT_UNLOCKED_FREE_PAGE:3012,EVENT_SUBSCRIPTION_STATE:4e3};var o=Object.freeze({WEB:/^web_/gim,AMP:/^amp_/gim});var r=Object.freeze({SWG:"swg"});var i=Object.freeze({IFRAME_PARENT_LOCATION:"iploc",VIEW:"view"});var a=Object.freeze({FALSY_REQUIRED_ARGUMENT:"A required argument is falsy.",INVALID_REQUIRED_ARGUMENT:"A required argument is not valid.",INVALID_TYPE_REQUIRED_ARGUMENT:"A required argument type is not valid.",UNEXPECTED_ERROR:"An unexpected error has occurred.",UNEXPECTED_VALUE:"A value provided is not valid."});var c=Object.freeze({"elmundo.es":{SWG_PUBLICATION_ID:"elmundo.es"},"expansion.com":{SWG_PUBLICATION_ID:"expansion.com"}});var l=Object.freeze({SWG_BUTTONS:"[data-swg-smart-button]"});var u=Object.freeze({OZONE_KNOWS_PUBLISHER_ENTITLEMENT:"001",OZONE_KNOWS_GOOGLE_ENTITLEMENT:"002",OZONE_DOES_NOT_KNOW_GOOGLE_ENTITLEMENT:"003",___CUSTOM___DEFERRED_OK:"c_001",LEGAL_ACCEPTANCE_OK:"211",LOGIN_OK:"165",SIGNUP_OK:"210",API_POST_ERROR:"410",GOOGLE_ENTITLEMENTS_NOT_FOUND:"412",INCOMPLETE_DATA:"401",INVALID_CSP:"459",INVALID_GOOGLE_ENTITLEMENTS_JWT:"411",INVALID_JWT:"457",LEGAL_ACCEPTANCE_REQUIRED:"264",UNLINKED_USER:"458",UNSUBSCRIBED_USER:"41",UNSUBSCRIBED_USER_BIS:"041",UNEXPECTED_ERROR:"500",USER_LINK_ALREADY_EXISTS:"164",USER_ALREADY_EXISTS:"176",USER_ALREADY_LINKED:"171",USER_AMP_RID_UNLINKED:"423",USER_DOES_NOT_EXISTS:"187",USER_DOES_NOT_EXISTS_ON_AN_UPDATE:"414",USER_IS_NOT_VERIFIED:"174",USER_LINK_DOES_NOT_EXISTS_OR_IS_NOT_VALID:"167",USER_MUST_VALIDATE_MAIL:"17",USER_MUST_VALIDATE_MAIL_BIS:"017"});var E=Object.freeze({OK:"OK",NOK:"NOK",ERROR:"ERR"});var d=Object.freeze({LOADING:0,LOADED:1,NOT_LOADED:2});var h=Object.freeze({AUTOLOGIN_REJECTED:"ue-swg_ar",ATTEMPTS_REACHED:"ue-swg_ma",LOGGED_OUT:"ue-swg-lo",SUSCRIPTOR:"suscriptor"});const S={MODE:"production",IS_PRODUCTION:!0,WINDOW_GLOBAL_LIBRARY_KEY:"ueSwg",LIBRARY:"ue-swg"},_={GDPR_USER_CONSENT_REQUIRED:!0},w={"elmundo.es":{AUTH_ORIGIN:"seguro.elmundo.es",AUTH_VERSION:"v3",COOKIE:"REGMUNDO",SWG_CSP:"10607",ENTITLEMENT_SOURCE_KEY:"elmundo",PID:"5",SITE_CODE:"8",SWG_PUBLICATION_ID:"elmundo.es",ACCOUNT_IFRAME_SRC:"https://seguro.elmundo.es/registro/v3/?view=swg",LOGIN_BASE_URL:"https://seguro.elmundo.es/registro/v3/?view=login",LOOK_UP_USER_BY_ENTITLEMENTS_ENDPOINT:"https://seguro.elmundo.es/ueregistro/v1/ozone/datos-jwt"},"expansion.com":{AUTH_ORIGIN:"seguro.expansion.com",AUTH_VERSION:"v3",COOKIE:"expansionID",SWG_CSP:"10608",ENTITLEMENT_SOURCE_KEY:"expansion",PID:"9",SITE_CODE:"4",SWG_PUBLICATION_ID:"expansion.com",ACCOUNT_IFRAME_SRC:"https://seguro.expansion.com/registro/v3/?view=swg",LOGIN_BASE_URL:"https://seguro.expansion.com/registro/v3/?view=swg",LOOK_UP_USER_BY_ENTITLEMENTS_ENDPOINT:"https://seguro.expansion.com/ueregistro/v1/ozone/datos-jwt"}},O=(()=>{const e=w[window.location.hostname];if(e)return e;const t=window.location.hostname.split(".");t.shift();const n=t.join(".");return w[n]||{}})();var T=(()=>{var e,t;const n=(null===(e=window.localStorage)||void 0===e?void 0:e.getItem("ue-dcv"))||(null===(t=window.localStorage)||void 0===t?void 0:t.getItem("ue-dcv-"+S.LIBRARY))||!1===S.IS_PRODUCTION,s={};if(["debug","error","info","log","warn","dir","dirxml","table","trace","group","groupCollapsed","groupEnd","clear","count","countReset","assert","profile","profileEnd","time","timeLog","timeEnd","timeStamp","context","memory"].forEach(e=>{s[e]=window.console[e]||function(){}}),n)return s;return Object.keys(console).forEach(e=>s[e]=()=>{}),s})();var g=Object.freeze({AUTOLOGIN:"autologin",DEFERRED_LINK:"deferred",READY:"ready",UNKNOW_ERROR:"unknow-error",UNDEFINED:void 0,VISIBILITY:"visibility"});class I{constructor(e,t,n){(!t||!Object.values(this.constructor.purposes).includes(t))&&(this.purpose=this.constructor.purposes.UNKNOW),this.purpose=t,this.error=e||null,this.data=n}}I.purposes=g;var f=I;function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class C{constructor(){if(N(this,"isLogged",void 0),N(this,"isPremium",void 0),this.constructor.instance)return T.warn("[UeSwg] AccountController.constructor: `AccountController.instance` found"),this.constructor.instance;this.constructor.instance=this}async waitToLoginPremium(){return new Promise(e=>{document.addEventListener("ue-loginpremium-ready",e)})}async updateInfo(){var e,t;const n=sessionStorage.getItem(h.SUSCRIPTOR);if(n)try{const{isLogged:e,isPremium:t}=JSON.parse(n)||{};if(e&&t)return T.count("[UeSwg] Account.updateInfo: info from `window.sessionStorage`"),this.isLogged=e,void(this.isPremium=t)}catch(e){T.warn("[UeSwg] Account.updateInfo: An error has occurred while parsing the stored suscriptor info",e)}"function"!=typeof(null===(e=window.ueLoginPremium)||void 0===e?void 0:e.update)&&await this.waitToLoginPremium(),T.count("[UeSwg] Account.updateInfo: info from `window.ueLoginPremium`");const{isLogged:s,isPremium:o}=await(null===(t=window.ueLoginPremium)||void 0===t?void 0:t.update())||{};this.isLogged=s,this.isPremium=o}async hasAccess(){return await this.updateInfo(),this.isLogged&&this.isPremium}}N(C,"instance",void 0);var p=C;var m=class{constructor(){if(this.constructor.instance)return this.constructor.instance;this.constructor.instance=this}async attachAnalytics(e){if(!e)throw new Error(a.INVALID_REQUIRED_ARGUMENT);(await e.getEventManager()).registerEventListener(this.handleSwgEvent.bind(this))}expectedSku(e){return Object.values(o).some(t=>t instanceof RegExp&&t.test(e))}handleSwgEvent(e){const{eventType:t,additionalParameters:n}=e,o=n&&n.getSku();switch(t){case s.ACTION_ALREADY_SUBSCRIBED:this.sendAlreadySubscribedClicked();break;case s.ACTION_OFFER_SELECTED:this.sendOfferSelected(o);break;case s.ACTION_PAYMENT_FLOW_STARTED:this.sendPaymentStarted(o);break;case s.ACTION_SAVE_SUBSCR_TO_GOOGLE_CONTINUE:this.sendAccounLinkingContinue();break;case s.ACTION_SAVE_SUBSCR_TO_GOOGLE_CANCEL:this.sendAccounLinkingReject();break;case s.IMPRESSION_ACCOUNT_CHANGED:this.sendPaymentConfirmation(o);break;case s.ACTION_USER_CANCELED_PAYFLOW:this.sendPaymentCancelled(o);break;case s.IMPRESSION_GOOGLE_UPDATED:this.sendAccounLinkingConfirmation();break;case s.IMPRESSION_SAVE_SUBSCR_TO_GOOGLE:this.sendAccounLinkingPreview()}}sendEventToAnalytics(e,t,n,s){switch(e){case"preview":"function"==typeof window.envioPreviewModuloGenerico&&window.envioPreviewModuloGenerico(t,n);break;case"click":"function"==typeof window.envioClickModuloGenerico&&window.envioClickModuloGenerico(t,n);break;case"utagView":this.callUtag("view",t,n,s);break;case"utagLink":this.callUtag("link",t,n,s)}}callUtag(e,t,n,s){window.utag&&"function"==typeof window.utag[e]?window.utag[e]({tealium_event:n,ecommerce_action:t,be_onclick:n,product_quantity:["1"],event_category:"ecommerce",product_id:[s]}):window.ueDataLayer&&"function"==typeof window.ueDataLayer.entryError&&window.ueDataLayer.entryError("no se encuentra Tealium")}sendAutologinPreview(){this.sendEventToAnalytics("preview","swg consent - preview","swg consent - preview")}sendAutologinContinue(){this.sendEventToAnalytics("click","swg consent - continue","swg consent - continue")}sendAutologinReject(){this.sendEventToAnalytics("click","swg consent - no thanks","swg consent - no thanks")}sendAutologinConfirmation(){this.sendEventToAnalytics("preview","swg consent - confirmation","swg consent - confirmation")}sendDeferredPreview(){this.sendEventToAnalytics("preview","swg dac - preview","swg dac - preview")}sendDeferredContinue(){this.sendEventToAnalytics("click","swg dac - continue","swg dac - continue")}sendDeferredReject(){this.sendEventToAnalytics("click","swg dac - no thanks","swg dac - no thanks")}sendDeferredConfirmation(){this.sendEventToAnalytics("preview","swg dac - confirmation","swg dac - confirmation")}sendAccounLinkingPreview(){this.sendEventToAnalytics("preview","swg access susbs - preview","swg access susbs - preview")}sendAccounLinkingContinue(){this.sendEventToAnalytics("click","swg access susbs - continue","swg access susbs - continue")}sendAccounLinkingReject(){this.sendEventToAnalytics("click","swg access susbs - no thanks","swg access susbs - no thanks")}sendAccounLinkingConfirmation(){this.sendEventToAnalytics("preview","swg access susbs - confir","swg access susbs - confir")}sendPaymentStarted(e){this.sendEventToAnalytics("utagView","begin_checkout","swg - begin_checkout",e)}sendPaymentCancelled(e){}sendPaymentConfirmation(e){e&&!this.expectedSku(e)||this.sendEventToAnalytics("utagView","purchase","swg - purchase",e)}sendAlreadySubscribedClicked(){this.sendEventToAnalytics("click","swg clic ya suscrito","swg clic ya suscrito")}sendOffersShown(){this.sendEventToAnalytics("preview","swg prev offer","swg prev offer")}sendOfferSelected(e){const t="premium:swg clic offer"+(e?" - "+e:"");this.sendEventToAnalytics("click","swg clic offer",t)}sendSmartButtonClicked(){this.sendEventToAnalytics("utagLink","add_to_cart","premium:swg clic inicio")}};function R(e,t){v(e,t),t.add(e)}function A(e,t,n){v(e,t),t.set(e,n)}function v(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function D(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,function(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}(e,t,"get"))}var y=new WeakMap,b=new WeakMap,P=new WeakSet,M=new WeakSet,G=new WeakSet,k=new WeakSet,W=new WeakSet,B=new WeakSet,F=new WeakSet;class j{constructor(){if(R(this,F),R(this,B),R(this,W),R(this,k),R(this,G),R(this,M),R(this,P),U(this,"iframe",void 0),A(this,y,{writable:!0,value:O}),A(this,b,{writable:!0,value:new Map}),this.constructor.instance)return T.warn("[UeSwg] ServiceController.constructor: `ServiceController.instance` found"),this.constructor.instance;this.constructor.instance=this}autoLogin(e,t){T.log("[UeSwg] ServiceController.autoLogin (userJWT, entitlementsJWT)",e,t);const n=D(this,y).SITE_CODE,s=D(this,y).SWG_CSP;if(!(s&&n&&e&&t))throw T.error("[UeSwg] ServiceController.autoLogin: both `csp`, `siteCode`, `userJWT` and `entitlementsJWT` must be truly (csp, siteCode, userJWT, entitlementsJWT)",s,n,e,t),new Error(a.FALSY_REQUIRED_ARGUMENT);const o={csp:s,entitlementsJWT:t,portal:n,userJWT:e},r=L(this,k,Y).call(this),i=new f(null,f.purposes.AUTOLOGIN,o);L(this,B,J).call(this,r,i)}changeIframeVisibility(e){if(T.count("[UeSwg] ServiceController.#changeIframeVisibility"),e)return this.iframe.width=window.innerWidth,this.iframe.height=window.innerHeight,void(this.iframe.style.opacity="1");this.iframe.width="1px",this.iframe.height="1px",this.iframe.style.opacity="0"}createOrLinkToAnExistingAccount(e,t,n,s){T.log("[UeSwg] ServiceController.createOrLinkToAnExistingAccount (userDataJWT, purchaseDataRaw, entitlementsJWT, userData)",e,t,n,s);const o=D(this,y).SITE_CODE,r=D(this,y).SWG_CSP;if(!(r&&o&&e&&t&&n&&s))throw T.error("[UeSwg] ServiceController.autoLogin: both `csp`, `siteCode`, `userDataJWT`, `purchaseDataRaw`, `entitlementsJWT` and `userData` must be truly (csp, siteCode, userDataJWT, purchaseDataRaw, entitlementsJWT, userData)",r,o,e,t,n,s),new Error(a.FALSY_REQUIRED_ARGUMENT);const i=L(this,k,Y).call(this),c={csp:r,portal:o,purchaseDataRaw:t,userDataJWT:e,entitlementsJWT:n,userData:s},l=new f(null,f.purposes.DEFERRED_LINK,c);L(this,B,J).call(this,i,l)}destroyIframe(){var e,t;T.count("[UeSwg] ServiceController.destroyIframe"),null===(e=this.iframe)||void 0===e||null===(t=e.remove)||void 0===t||t.call(e),this.iframe=null}async lookUpUserByEntitlements(e){T.log("[UeSwg] ServiceController.lookUpUserByEntitlements (entitlementsResponse)",e);const t={portal:D(this,y).SITE_CODE,...e},n=O.LOOK_UP_USER_BY_ENTITLEMENTS_ENDPOINT;return L(this,G,V).call(this,n,t,{credentials:"include"})}proccessQueue(){T.count("[UeSwg] ServiceController.proccessQueue"),D(this,b).forEach(e=>{L(this,W,H).call(this,e)}),D(this,b).clear()}redirectToLogin(){T.count("[UeSwg] ServiceController.redirectToLogin");const e=`${D(this,y).LOGIN_BASE_URL}&url_redirect=${encodeURIComponent(window.location.href)}`;window.location.href=e}}function K(){document.body.appendChild(this.iframe)}function x(e){if(T.log("[UeSwg] ServiceController.#createIframe (queryParams)",e),this.iframe)return;const t=new URL(O.ACCOUNT_IFRAME_SRC);Object.keys(e).forEach(n=>{t.searchParams.set(n,e[n])}),this.iframe=document.createElement("iframe"),this.iframe.src=t.href}async function V(e,t={},n={}){let s;switch(T.log("[UeSwg] ServiceController.#fetch (url, data, options)",e,t,n),(n=Object.assign({},{method:"POST",headers:{"Content-Type":"application/json"}},n)).method){case"GET":{const o=new URL(e);t&&Object.keys(t).forEach(e=>{const n=o.searchParams.get(e),s=t[e];n&&o.searchParams.delete(e),o.searchParams.set(e,s)}),s=await fetch(e,n);break}case"POST":default:n.body=JSON.stringify(t),s=await fetch(e,n)}if(!s.ok)throw T.error("[UeSwg] ServiceController.#fetch: unexpected `response` (response, url, data, options)",s,e,t,n),new Error(a.UNEXPECTED_ERROR);return s.json()}function Y(){T.count("[UeSwg] ServiceController.#getNormalizedQueryParams");return{[i.IFRAME_PARENT_LOCATION]:window.location.href,[i.VIEW]:r.SWG}}function H(e){T.log("[UeSwg] ServiceController.#postMessageToIframe (message)");const t=new URL(this.iframe.src).origin;this.iframe.contentWindow.postMessage(e,t)}async function J(e,t){if(T.log("[UeSwg] ServiceController.#sendIframeRequest (queryParams, message)",e,t),!e)throw T.warn("[UeSwg] ServiceController.#postMessageToIframe: `queryParams` is falsy"),new Error(a.FALSY_REQUIRED_ARGUMENT);if(!(t instanceof f))throw T.warn("[UeSwg] ServiceController.#postMessageToIframe: `message` is not a `Message` instance"),new Error(a.INVALID_TYPE_REQUIRED_ARGUMENT);D(this,b).set(t.purpose,t),L(this,M,x).call(this,e),L(this,F,X).call(this),L(this,P,K).call(this)}function X(){T.count("[UeSwg] ServiceController.#setIframeStyles"),this.changeIframeVisibility(!1),this.iframe.style.display="block",this.iframe.style.position="fixed",this.iframe.style.top="0",this.iframe.style.left="0",this.iframe.style.zIndex="999999999999999"}U(j,"instance",void 0);var z=j;var Q=e=>e.replace(/-([a-z])/g,(function(e){return e[1].toUpperCase()}));function $(e,t){Z(e,t),t.add(e)}function q(e,t,n){Z(e,t),t.set(e,n)}function Z(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ee(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,ne(e,t,"get"))}function te(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,ne(e,t,"set"),n),n}function ne(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function se(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var oe,re,ie,ae=new WeakMap,ce=new WeakMap,le=new WeakSet,ue=new WeakSet,Ee=new WeakSet;class de{constructor(){if($(this,Ee),$(this,ue),$(this,le),q(this,ae,{writable:!0,value:new m}),q(this,ce,{writable:!0,value:void 0}),this.constructor.instance)return T.warn("[UeSwg] SmartButtonsController.constructor: `SmartButtonsController.instance` already found!"),this.constructor.instance;this.constructor.instance=this,se(this,Ee,_e).call(this)}async attachNewSmartButtons(e){if(T.count("[UeSwg] SmartButtonsController.#attachNewSmartButtons"),te(this,ce,ee(this,ce)||e),!ee(this,ce))throw T.error("[UeSwg] SmartButtonsController.#attachNewSmartButtons: `subscriptions` is falsy"),new Error(a.INVALID_REQUIRED_ARGUMENT);const t=Array.from(document.querySelectorAll(l.SWG_BUTTONS)),n=t.filter(e=>!e.dataset.swgBinded);T.log(`[UeSwg] SmartButtonsController.#attachNewSmartButtons: found ${n.length}/${t.length} (new/all) buttons`),n.forEach(e=>{e.dataset.swgBinded=!0;const t=se(this,le,he).call(this,e),n=se(this,ue,Se).call(this,t),s=ee(this,ce).createButton({lang:"es"},n);e.appendChild(s)})}}function he(e){if(!(e instanceof HTMLElement))throw T.error("[UeSwg] SmartButtonsController.#getSmartButtonConfig: element must be a `HTMLElement` instance"),new Error(a.INVALID_TYPE_REQUIRED_ARGUMENT);const t=l.SWG_BUTTONS.replace(/.*\[data-([\w-]*?)\].*/gm,"$1"),n=Q(t),s=e.dataset[n]||"",o={},r=e=>/^true|false|\[[,.:'"\w\s-]*?\]$/gim.test(e);return s.replace(/\s*/gm,"").split(";").forEach(e=>{const[t,n]=e.split(":");if(!t||!n)return;const s=r(n)?JSON.parse(n):n.includes(",")?n.split(",").map(e=>r(e)?JSON.parse(e):e):n;o[t]=s}),o}function Se(e={}){let t,n;switch(e.method){case"subscribe":if(t="subscribe",n=e.sku,!n)throw T.error("[UeSwg] SmartButtonsController.#getSmartButtonCallback: you must provide a nof falsy `sku`"),new Error(a.FALSY_REQUIRED_ARGUMENT);break;case"showOffers":default:{t="showOffers",e.skus&&(e.skus=e.skus instanceof Array?e.skus:[e.skus]);const{list:s,oldSku:o,skus:r}=e,i="boolean"!=typeof e.isClosable||e.isClosable;n={isClosable:i,list:s,oldSku:o,skus:r};break}}return()=>{T.log("[UeSwg] SmartButtonsController.#getSmartButtonCallback: Smart button clicked (providedData, method, argument)",e,t,n),ee(this,ae).sendSmartButtonClicked(),"showOffers"===t&&ee(this,ae).sendOffersShown(),ee(this,ce)[t](n)}}function _e(){window.ueSwgSmartButtonCallback=(e,t)=>{const n={isClosable:!0};switch(e){case"subscribe":n.method=e,n.sku=t;break;case"showOffers":default:n.method="showOffers",n.sku=null==t?void 0:t.split(",")}const s=se(this,ue,Se).call(this,n);"function"==typeof s&&s()}}ie=void 0,(re="instance")in(oe=de)?Object.defineProperty(oe,re,{value:ie,enumerable:!0,configurable:!0,writable:!0}):oe[re]=ie;var we=de;function Oe(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function Te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ge(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var Ie=new WeakSet;class fe{constructor(){if(Oe(this,Ie),Te(this,"EXISTS","1"),this.constructor.instance)return T.warn("[UeSwg] StorageController.constructor: `StorageController.instance` already found!"),this.constructor.instance;this.constructor.instance=this}clearStoredAttemptsReached(){localStorage.removeItem(h.ATTEMPTS_REACHED)}clearStoredLoggedOut(){localStorage.removeItem(h.LOGGED_OUT)}clearStoredRejection(){localStorage.removeItem(h.AUTOLOGIN_REJECTED)}getStoredAttemptsReached(){const e=localStorage.getItem(h.ATTEMPTS_REACHED),t=ge(this,Ie,Ne).call(this)===e;return e&&!t&&this.clearStoredAttemptsReached(),t}getStoredLoggedOut(){const e=localStorage.getItem(h.LOGGED_OUT),t=e===this.EXISTS;return e&&!t&&this.clearStoredRejection(),t}getStoredRejection(){const e=localStorage.getItem(h.AUTOLOGIN_REJECTED),t=e===this.EXISTS;return e&&!t&&this.clearStoredRejection(),t}storeAttemptsAsReached(){const e=ge(this,Ie,Ne).call(this);localStorage.setItem(h.ATTEMPTS_REACHED,e)}storeLoggedOut(){localStorage.setItem(h.LOGGED_OUT,this.EXISTS)}storeRejection(){localStorage.setItem(h.AUTOLOGIN_REJECTED,this.EXISTS)}}function Ne(){const e=new Date;return`${e.getMonth()}/${e.getDate()}/${e.getFullYear()}-${this.EXISTS}`}Te(fe,"instance",void 0);var Ce=fe;function pe(e,t){me(e,t),t.add(e)}function me(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ae(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,function(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}(e,t,"get"))}function ve(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var Ue=new WeakMap,Le=new WeakSet,De=new WeakSet;class ye{constructor(){if(pe(this,De),pe(this,Le),Re(this,"isAccessibleForFree",void 0),Re(this,"schema",void 0),Re(this,"productID",void 0),function(e,t,n){me(e,t),t.set(e,n)}(this,Ue,{writable:!0,value:["CreativeWork","Article","NewsArticle","Blog","Comment","Course","HowTo","Message","Review","WebPage"]}),this.constructor.instance)return T.warn("[UeSwg] SchemaController.constructor: `SchemaController.instance` found"),this.constructor.instance;this.constructor.instance=this,this.setInfo()}setInfo(){try{Array.from(document.querySelectorAll('script[type="application/ld+json"]')).some(e=>{const t=JSON.parse(e.textContent);(t instanceof Array?t:[t]).some(ve(this,De,Pe).bind(this))})}catch(e){T.error("[UeSwg] SchemaController.setInfo: an error has ocurred while parsing the schema")}}check(){return Boolean(this.schema)}}function be(e){let t=e["@type"];if(!t)return;t=t instanceof Array?t:[t];const n=e.isAccessibleForFree,s=e.isPartOf,o=null==s?void 0:s.productID;"boolean"==typeof n&&s&&o&&t.some(e=>Ae(this,Ue).includes(e))&&(this.isAccessibleForFree=n,this.productID=o,this.schema=e,T.log("[UeSwg] SchemaController.setInfo: schema found (schema)",e))}function Pe(e){return ve(this,Le,be).call(this,e),this.check()}Re(ye,"instance",void 0);var Me=ye;var Ge=function(e,t){if(!e)throw new Error("[UeSwg] You must provide an URL to load an external script.");const{context:n,when:s,onsetup:o,onsuccess:r,onerror:i,attributes:a}=t;"function"==typeof o&&o.call(n);const c=document.createElement("script");switch(c.type="text/javascript",s){case"async":c.async=!0;break;case"defer":c.defer=!0}c.onload=function(){"function"==typeof r&&r.call(n)},c.onerror=function(t){"function"==typeof i&&i.call(n,`Error loading ${e}.`)},c.src=e,a&&Object.keys(a).forEach(e=>c.setAttribute(e,a[e])),document.head.appendChild(c)};var ke=class{constructor(e){if(this.constructor.instance)return this.constructor.instance;this.constructor.instance=this,this.SWG_SRC="https://news.google.com/swg/js/v1/swg.js",this.currentProductIds=(()=>{const e=c[window.location.hostname];if(e)return e;const t=window.location.hostname.split(".");t.shift();const n=t.join(".");return c[n]||{}})(),this.manualInit=e,this.subscriptions=null,this.SWG=self.SWG=self.SWG||[],this.swgStatus=d.NOT_LOADED}async init(e){this.SWG.push(t=>{if(!t)throw new Error(a.INVALID_REQUIRED_ARGUMENT);this.subscriptions=t;const n=this.currentProductIds.SWG_PUBLICATION_ID;n&&(this.manualInit&&this.subscriptions.init(n),"function"==typeof e&&e(t))}),this.addSwgScript()}addSwgScript(){if(this.swgStatus===d.LOADED||this.swgStatus===d.LOADING)return;this.swgStatus=d.LOADING;const e=this.SWG_SRC,t={context:this,when:"defer",attributes:this.manualInit?{"subscriptions-control":"manual"}:{},onsetup(){this.swgStatus=d.LOADING},onsuccess(){this.swgStatus=d.LOADED},onerror(){this.swgStatus=d.NOT_LOADED}};Ge(e,t)}};function We(e,t){Fe(e,t),t.add(e)}function Be(e,t,n){Fe(e,t),t.set(e,n)}function Fe(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ke(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function xe(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,Ye(e,t,"set"),n),n}function Ve(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Ye(e,t,"get"))}function Ye(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var He=new WeakMap,Je=new WeakMap,Xe=new WeakMap,ze=new WeakSet,Qe=new WeakSet,$e=new WeakSet,qe=new WeakSet,Ze=new WeakSet,et=new WeakSet,tt=new WeakSet,nt=new WeakSet,st=new WeakSet,ot=new WeakSet,rt=new WeakSet;class it{constructor(){if(We(this,rt),We(this,ot),We(this,st),We(this,nt),We(this,tt),We(this,et),We(this,Ze),We(this,qe),We(this,$e),We(this,Qe),We(this,ze),je(this,"accountController",new p),je(this,"analyticsController",new m),je(this,"schemaController",new Me),je(this,"serviceController",new z),je(this,"smartButtonsController",new we),je(this,"storageController",new Ce),je(this,"swgController",void 0),je(this,"subscriptions",void 0),Be(this,He,{writable:!0,value:!1}),Be(this,Je,{writable:!0,value:void 0}),Be(this,Xe,{writable:!0,value:void 0}),this.constructor.instance)return T.warn("[UeSwg] Manager.constructor: `Manager.instance` already found!"),this.constructor.instance;this.constructor.instance=this}async init(){if(Ve(this,Je))return void T.warn("[UeSwg] Manager.init: Manager is already built");xe(this,Je,!0);const e=!this.schemaController.check();this.swgController=new ke(e),this.swgController.init(Ke(this,ot,wt).bind(this))}}function at(){Ve(this,He)?T.warn("[UeSwg] Manager.#bindEvents: already binded"):(xe(this,He,!0),window.addEventListener("message",e=>{var t;const n=(null===(t=this.serviceController.iframe)||void 0===t?void 0:t.src)&&new URL(this.serviceController.iframe.src),{error:s,purpose:o,data:r}=e.data||{},i=new f(s,o,r);e.origin!==(null==n?void 0:n.origin)||i.purpose===f.purposes.UNDEFINED||Ke(this,et,dt).call(this,i)},!0),document.addEventListener("nc-urlChanged",this.smartButtonsController.attachNewSmartButtons.bind(this.smartButtonsController)),document.addEventListener("@ue-content-updated",this.smartButtonsController.attachNewSmartButtons.bind(this.smartButtonsController)),document.addEventListener("logout",this.storageController.storeLoggedOut.bind(this.storageController)))}async function ct(e,t){T.count("[UeSwg] Manager.#doAutoLoginFlow");try{this.analyticsController.sendAutologinPreview(),await this.subscriptions.showLoginPrompt(),this.analyticsController.sendAutologinContinue()}catch(e){return this.analyticsController.sendAutologinReject(),void this.storageController.storeRejection()}this.serviceController.autoLogin(e,t)}async function lt(e){var t;T.log(`[UeSwg] Manager.#doDeferredLinkFlow: found ${null==e||null===(t=e.entitlements)||void 0===t?void 0:t.length} entitlements`);const n={entitlements:e,consent:!0};try{this.analyticsController.sendDeferredPreview();const e=await this.subscriptions.completeDeferredAccountCreation(n);this.analyticsController.sendDeferredContinue(),Ke(this,Ze,Et).call(this,e)}catch(e){this.analyticsController.sendDeferredReject(),this.storageController.storeRejection()}}async function ut(e){try{var t;if(!(e=e||await this.subscriptions.getEntitlements()))throw T.error("[UeSwg] Manager.#handleEntitlements: `entitlements` is falsy"),new Error(a.INVALID_REQUIRED_ARGUMENT);T.log("[UeSwg] Manager.#handleEntitlements (entitlements)",null===(t=e)||void 0===t?void 0:t.entitlements);if(!e.enablesThis())return void T.warn("[UeSwg] Manager.#handleEntitlements: User does not have any entitlement for this content");const n=this.serviceController.lookUpUserByEntitlements(e),{status:s,data:o}=await this.subscriptions.waitForSubscriptionLookup(n);switch(s){case E.OK:{const{codigo:t,jwt:n}=o||{},r=t;if(!o||!r||!/^001|002|003$/.test(r)){T.error("[UeSwg] Manager.#handleEntitlements: unexpected response, `data` must be an object with an expected `codigo` (status, data)",s,o);break}switch(String(r)){case u.OZONE_DOES_NOT_KNOW_GOOGLE_ENTITLEMENT:Ke(this,$e,lt).call(this,e);break;case u.OZONE_KNOWS_GOOGLE_ENTITLEMENT:case u.OZONE_KNOWS_PUBLISHER_ENTITLEMENT:default:{const t=n,s=e.raw;Ke(this,Qe,ct).call(this,t,s);break}}break}case E.ERROR:case E.NOK:{const t=null==o?void 0:o.codigo;if(!o||!t&&"string"!=typeof o){T.error("[UeSwg] Manager.#handleEntitlements: unexpected response (entitlementsResponse, status, data)",e,s,o);break}switch(String(t)){case u.GOOGLE_ENTITLEMENTS_NOT_FOUND:Ke(this,$e,lt).call(this,e);break;case u.INVALID_GOOGLE_ENTITLEMENTS_JWT:T.error("[UeSwg] Manager.#handleEntitlements: invalid entitlements (entitlementsResponse, status, data)",e,s,o);break;case u.UNEXPECTED_ERROR:default:T.error("[UeSwg] Manager.#handleEntitlements: unexpected error (code, entitlementsResponse, status, data)",t,e,s,o)}break}default:T.error("[UeSwg] Manager.#handleEntitlements: unexpected response (entitlementsResponse, status, data)",e,s,o)}e.ack()}catch(e){T.error("[UeSwg] Manager.#handleEntitlements : unexpected error (error)",e)}}async function Et(e){const t=await e,{userData:n,purchaseData:s,entitlements:o}=t,r=o.raw;xe(this,Xe,()=>t.complete()),this.serviceController.createOrLinkToAnExistingAccount(null==n?void 0:n.idToken,null==s?void 0:s.raw,r,n)}async function dt(e){T.log("[UeSwg] Manager.#onExpectedMessage (message)",e);const{error:t,purpose:n,data:s}=e;if(t)T.warn(`[UeSwg] Manager.#onExpectedMessage: An error has occurred while doing '${n}' (error, data)`,t,s);else switch(n){case f.purposes.READY:this.serviceController.proccessQueue();break;case f.purposes.VISIBILITY:this.serviceController.changeIframeVisibility(null==s?void 0:s.show);break;case f.purposes.AUTOLOGIN:this.serviceController.destroyIframe(),this.analyticsController.sendAutologinConfirmation(),Ke(this,rt,Ot).call(this);break;case f.purposes.DEFERRED_LINK:if(T.log("[UeSwg] Manager.#onExpectedMessage (complete)",Ve(this,Xe)),this.serviceController.destroyIframe(),"function"==typeof Ve(this,Xe)){this.analyticsController.sendDeferredConfirmation();const e=new Promise(e=>setTimeout(e,3e4,!1)),n=Ve(this,Xe).call(this);try{await Promise.race([e,n])}catch(t){T.error("[UeSwg] Manager.#onExpectedMessage: An error has occurred in complete proccess",t)}}Ke(this,rt,Ot).call(this);break;case f.purposes.UNKNOW_ERROR:(null==s?void 0:s.maxAttemptsReached)&&this.storageController.storeAttemptsAsReached(),T.error("[UeSwg] Manager.#onExpectedMessage: An unexpected error has occured.");break;case f.purposes.UNDEFINED:default:throw T.error("[UeSwg] Manager.#onExpectedMessage: Unexpected purpose."),this.serviceController.destroyIframe(),new Error(a.UNEXPECTED_VALUE)}}function ht(e){T.count("[UeSwg] Manager.#setOnEntitlementsResponse"),this.subscriptions.setOnEntitlementsResponse(async t=>{const n=await t;"function"==typeof e&&e.call(this,n)})}function St(){T.count("[UeSwg] Manager.#setOnLoginRequest"),this.subscriptions.setOnLoginRequest(this.serviceController.redirectToLogin.bind(this.serviceController))}function _t(){var e,t,n;T.count("[UeSwg] Manager.#setOnPaymentResponse");const s=()=>{setTimeout(()=>{this.subscriptions.setOnPaymentResponse(Ke(this,Ze,Et).bind(this))},0)},o="function"!=typeof(null===(e=window.uePiano)||void 0===e?void 0:e.onReady),r=!(null!==(t=window.uePiano)&&void 0!==t&&null!==(n=t.gdprConsentManager)&&void 0!==n&&n.globalConsent);if(o||r)return s(),window.tp=window.tp||[],void window.tp.push(["init",s]);window.uePiano.onReady(s)}async function wt(e){if(T.count("[UeSwg] Manager.#setOnSubscriptionsReady"),this.subscriptions=e,!this.subscriptions)return void T.warn("[UeSwg] Manager.#setOnSubscriptionsReady: `subscriptions` is falsy!");Ke(this,ze,at).call(this),this.analyticsController.attachAnalytics(e),this.smartButtonsController.attachNewSmartButtons(e),Ke(this,st,_t).call(this),Ke(this,nt,St).call(this);this.accountController.isLogged&&(T.count("[UeSwg] Manager.init: user is logged and rejection will be cleared."),this.storageController.clearStoredRejection());const t=await this.accountController.hasAccess(),n=this.storageController.getStoredRejection(),s=this.storageController.getStoredLoggedOut(),o=void 0===t,r=this.storageController.getStoredAttemptsReached();t||n||s||o||r?T.count("[UeSwg] Manager.init: user either has access, rejected entitlements link, did logout or is unknow."):Ke(this,tt,ht).call(this,Ke(this,qe,ut))}function Ot(){window.location.reload()}je(it,"instance",void 0);let Tt=!1;const gt=new it,It=()=>{_.GDPR_USER_CONSENT_REQUIRED?(window.onPolicyReady=window.onPolicyReady||[],window.onPolicyReady.push(async()=>{const e=window.ueCookiesPolicy;await e.promise(e.getUserConsentStatusForVendor.bind(e,"google"))?gt.init():(T.warn("[UeSwg] init: Google consent status is `falsy`"),Tt||(Tt=!0,window.addEventListener("ueConsentChanged",It)))})):gt.init()};"loading"===document.readyState?(T.log("[UeSwg] init: waiting to DOMContentLoaded"),document.addEventListener("DOMContentLoaded",It)):It()}]).ueSwg}));