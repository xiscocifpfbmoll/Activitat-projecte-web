(()=>{"use strict";const e=(()=>{const e={};if("object"==typeof window){const o=window.localStorage?.getItem("ue-dcv")||window.localStorage?.getItem("ue-dcv-zeotap");return["debug","error","info","log","warn","dir","dirxml","table","trace","group","groupCollapsed","groupEnd","clear","count","countReset","assert","profile","profileEnd","time","timeLog","timeEnd","timeStamp","context","memory"].forEach((o=>{e[o]=window.console[o]||function(){}})),o?e:(Object.keys(console).forEach((o=>e[o]=()=>{})),e)}return e.count=function(){},e})(),o=Object.freeze({"www.elmundo.es":{cookie:"REGMUNDO"},"seguro.elmundo.es":{cookie:"REGMUNDO"},"www.marca.com":{cookie:["REGMARCA","REGMARCAMEXICO"]},"seguro.marca.com":{cookie:"REGMARCA"},"seguro-mx.marca.com":{cookie:"REGMARCAMEXICO"},"co.marca.com":{cookie:"REGMARCACOLOMBIA"},"seguro-co.marca.com":{cookie:"REGMARCACOLOMBIA"},"us.marca.com":{cookie:"REGMARCA"},"seguro-us.marca.com":{cookie:"REGMARCAUSA"},"ar.marca.com":{cookie:"REGMARCAARGENTINA"},"seguro-ar.marca.com":{cookie:"REGMARCAARGENTINA"},"www.telva.com":{cookie:"REGTELVA"},"seguro.telva.com":{cookie:"REGTELVA"},"www.expansion.com":{cookie:"expansionID"},"seguro.expansion.com":{cookie:"expansionID"}}),t=Object.freeze({JWT:"uejwt",UE_ZEOTAP:"uezeotap"}),n=Object.freeze({IS_PREMIUM:"isPremium",USER_EMAIL_SHA:"user_email_sha256",CITY:"city",COUNTRY:"country",DATALAYER_VARIABLE:"ueDataLayer"});function r(e){this.message=e}r.prototype=new Error,r.prototype.name="InvalidCharacterError";var a="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var o=String(e).replace(/=+$/,"");if(o.length%4==1)throw new r("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,n,a=0,i=0,c="";n=o.charAt(i++);~n&&(t=a%4?64*t+n:n,a++%4)?c+=String.fromCharCode(255&t>>(-2*a&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return c};function i(e){var o=e.replace(/-/g,"+").replace(/_/g,"/");switch(o.length%4){case 0:break;case 2:o+="==";break;case 3:o+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(a(e).replace(/(.)/g,(function(e,o){var t=o.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t})))}(o)}catch(e){return a(o)}}function c(e){this.message=e}c.prototype=new Error,c.prototype.name="InvalidTokenError";class s{currentLocationKeys=o[window.location.hostname];obtainLoginInfo(){const e=this.getCookieValueByName(this.currentLocationKeys?.cookie);return{isLogged:Boolean(e),jwt:this.obtainDecodedJwt(),identitySended:localStorage.getItem(t.UE_ZEOTAP)}}obtainDecodedJwt(){if(!this.currentLocationKeys?.cookie||!t.JWT)return e.count("[Zeotap] ZeotapController error in config info to obtain login info"),{};let o=localStorage.getItem(t.JWT);if(o)try{return o=function(e,o){if("string"!=typeof e)throw new c("Invalid token specified");var t=!0===(o=o||{}).header?0:1;try{return JSON.parse(i(e.split(".")[t]))}catch(e){throw new c("Invalid token specified: "+e.message)}}(o),o}catch(e){return null}return null}obtainUserInfoProperties(){const e={};if(n&&n.DATALAYER_VARIABLE&&"object"==typeof window[n.DATALAYER_VARIABLE]){const o=window[n.DATALAYER_VARIABLE];e.country=o[n.COUNTRY],e.isPremium=o[n.IS_PREMIUM],e.city=o[n.CITY]}return e}getHid(o){return e.count("[Zeotap] Account #getHid"),o&&o.hid?o.hid:null}getCookieValueByName(e){let o=e;Array.isArray(e)&&(o=e.find((e=>document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)"))));const t=document.cookie.match("(^|;) ?"+o+"=([^;]*)(;|$)");return t?t[2]:null}}new class{isLogged=!1;jwt=null;dataManager=null;constructor(){e.count("[Zeotap] ZeotapController constructor"),this.dataManager=new s,this.bindEvents()}setZeotapStorage(){t.UE_ZEOTAP&&(e.count("[Zeotap] Setting ueZeotap storage. User logged"),localStorage.setItem(t.UE_ZEOTAP,Date.now()))}removeZeotapStorage(){t.UE_ZEOTAP&&(e.count("[Zeotap] Erasing ueZeotap storage because user not logged"),localStorage.removeItem(t.UE_ZEOTAP))}manageLogout(o){o&&(e.count("[Zeotap] Logout fallback detected"),this.removeZeotapStorage())}sendLogoutInfo(){const e=localStorage.getItem(t.UE_ZEOTAP);e&&this.manageLogout(e)}sendUserIdentities(o){e.count("[Zeotap] Trying to send userIdentities....");const t=this.dataManager.getHid(o);t&&(e.count("[Zeotap] sending userIdentities "+t),this.setZeotapStorage(),window.zeotap.setUserIdentities({email:t},!0))}sendLoggedUserInfo(){const{isLogged:o,jwt:t,identitySended:n}=this.dataManager.obtainLoginInfo();if(o)if(o&&n)e.count("[Zeotap] not Sending userIdentities because of ueZeotap storage exists");else if(t)this.sendUserIdentities(t);else{const e=()=>{let e=this.dataManager.obtainDecodedJwt();e&&this.sendUserIdentities(e)};document.addEventListener("loggedUser",e.bind(this))}else this.manageLogout(n)}bindEvents(){e.count("[Zeotap] Zeotap Controller #bindEvents");const o=()=>{e.count("[Zeotap]  Zeotap #bindEvents: LOGOUT"),this.sendLogoutInfo(),document.removeEventListener("logout",o)},t=async()=>{if(!window.zeotap||"function"!=typeof window.zeotap.setUserIdentities)return console.log("[Zeotap] ZeoTap library not present in the site"),void window.document.addEventListener("UEZeotap",function(){this.sendLoggedUserInfo()}.bind(this));this.sendLoggedUserInfo()};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t.bind(this)):t(),document.addEventListener("logout",o.bind(this))}},window.ueZeotap={}.UEZeotap})();var event= new CustomEvent("wc-UEZeotap",{bubbles:true});
document.dispatchEvent(event);
